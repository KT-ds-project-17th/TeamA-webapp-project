<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.notice">


	<!--  공지사항 리스트
	<select id="selectAllNoticeList"
		resultType="com.mySpring.springEx.notice.vo.NoticeVO">
	 <![CDATA[
		 select notice_no, notice_category, notice_contents, notice_title, notice_hit, notice_adminID, notice_date from notice order by notice_no desc
	]]>
	</select> -->


	<!-- 공지사항 글 작성 -->
	<insert id="insertNotice" parameterType="noticeVO" useGeneratedKeys="true" keyProperty="notice_no">
	<selectKey keyProperty="notice_no" resultType="int" order="BEFORE">
	 SELECT notice_SEQ.NEXTVAL FROM DUAL
	    </selectKey>
		insert into notice(notice_no, notice_category, notice_title,
		notice_contents, notice_adminID)
		VALUES (#{notice_no}, #{notice_category}, #{notice_title},
		#{notice_contents}, #{notice_adminID})

	</insert>


	<!-- 공지사항 조회 -->
	<select id="readNotice" parameterType="int"
		resultType="com.mySpring.springEx.notice.vo.NoticeVO">
	 <![CDATA[
		 select notice_no, notice_category, notice_title, notice_contents, notice_adminID, notice_date, notice_hit from notice
		 where notice_no = #{notice_no}	]]>
	</select>


	<!-- 공지사항 수정 -->
	<update id="updateNotice" parameterType="com.mySpring.springEx.notice.vo.NoticeVO">
	 <![CDATA[
		update notice set notice_category = #{notice_category}, notice_title = #{notice_title}, notice_adminID = #{notice_adminID}, notice_contents = #{notice_contents}
		where notice_no = #{notice_no} 
	]]>
	</update>

	<!-- 공지사항 삭제 -->
	<delete id="deleteNotice" parameterType="int">
	 <![CDATA[
		delete from notice where notice_no = #{notice_no}
	]]>
	</delete>
	
	<!-- 공지사항 조회수 -->
	<update id="noticeHit" parameterType="int">
		update notice set
		notice_hit = notice_hit+1
		where notice_no = #{notice_no}
	</update>
	
	<!-- 첨부파일 업로드 -->
	<insert id="insertFile" parameterType="hashMap">
		INSERT INTO NT_FILE(
			NT_FILE_NO,
			NOTICE_NO,
			ORG_NT_FILE_NAME,
			STR_NT_FILE_NAME,
			NT_FILE_SIZE
		)VALUES(
			NT_FILE_SEQ.NEXTVAL,
			#{NOTICE_NO},
			#{ORG_NT_FILE_NAME},
			#{STR_NT_FILE_NAME},
			#{NT_FILE_SIZE}
		)
    </insert>
    
    <!-- 첨부파일 조회 -->
<select id="selectFileList" parameterType="String" resultType="hashMap">
	SELECT NT_FILE_NO,
		   ORG_NT_FILE_NAME,
		   STR_NT_FILE_NAME,
		   ROUND(NT_FILE_SIZE/1024,1) AS NT_FILE_SIZE
	  FROM NT_FILE
	 WHERE NOTICE_NO = #{NOTICE_NO}
	  AND NT_FILE_DEL = 'N'
    	 ORDER BY NT_FILE_NO ASC
</select>
    
	<!-- 첨부파일 다운로드 -->
	<select id="selectFileInfo" parameterType="hashMap" resultType="hashMap">
	SELECT 
		STR_NT_FILE_NAME,
		ORG_NT_FILE_NAME
	FROM NT_FILE
	WHERE NT_FILE_NO = #{NT_FILE_NO}
</select>

 <update id="updateFile" parameterType="hashMap">
    	UPDATE NT_FILE SET
    	NT_FILE_DEL = 'Y'
    	WHERE NT_FILE_NO = #{NT_FILE_NO}
    </update>
	
	
</mapper>